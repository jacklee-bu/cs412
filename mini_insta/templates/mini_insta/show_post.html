{% extends 'mini_insta/base.html' %}

{% block title %}Post by {{ post.profile.display_name }} - Mini Insta{% endblock %}

{% block content %}
<h2>Post by {{ post.profile.display_name }}</h2>

<p>
    <strong>Posted on:</strong> {{ post.timestamp|date:"F d, Y g:i A" }}
</p>

<div style="background-color: lightcyan; padding: 10px; margin: 15px 0; border: 1px solid black;">
    <strong style="font-size: 18px;">{{ post.get_likes.count }} Like{% if post.get_likes.count != 1 %}s{% endif %}</strong>

    {% if user.is_authenticated and logged_in_profile %}
        {% if can_like_post %}
            <!-- user can like/unlike if not their own post -->
            {% if has_liked_post %}
                <form method="POST" action="{% url 'mini_insta:delete_like' post.pk %}" style="display: inline; margin-left: 20px;">
                    {% csrf_token %}
                    <button type="submit"
                            style="padding: 3px 10px; background-color: lightcoral; border: 1px solid black; cursor: pointer;">
                        Unlike
                    </button>
                </form>
            {% else %}
                <form method="POST" action="{% url 'mini_insta:like' post.pk %}" style="display: inline; margin-left: 20px;">
                    {% csrf_token %}
                    <button type="submit"
                            style="padding: 3px 10px; background-color: lightgreen; border: 1px solid black; cursor: pointer;">
                        Like
                    </button>
                </form>
            {% endif %}
        {% endif %}
    {% endif %}
</div>

{% if post.caption %}
    <div style="background-color: lightyellow; padding: 10px; border: 1px solid black; margin: 20px 0;">
        <strong>Caption:</strong><br>
        {{ post.caption }}
    </div>
{% else %}
    <p><i>No caption provided</i></p>
{% endif %}

<hr>

<h3 style="color: green;">Comments ({{ post.get_all_comments.count }})</h3>
<div style="margin: 20px 0;">
    {% for comment in post.get_all_comments %}
        <div style="background-color: lavender; padding: 10px; margin: 10px 0; border: 1px solid gray;">
            <strong>{{ comment.profile.display_name }}</strong> (@{{ comment.profile.username }})<br>
            <small style="color: gray;">{{ comment.timestamp|date:"M d, Y g:i A" }}</small><br>
            <p style="margin-top: 5px;">{{ comment.text }}</p>
        </div>
    {% empty %}
        <p style="font-style: italic; color: gray;">No comments yet. Be the first to meow!</p>
    {% endfor %}
</div>

<hr>

<h3>Photos</h3>
<div style="display: flex; flex-wrap: wrap; gap: 20px;">
    {% for photo in post.get_all_photos %}
        <div style="border: 2px solid gray;">
            <img src="{{ photo.get_image_url }}" alt="Photo {{ forloop.counter }}"
                 style="max-width: 400px; max-height: 400px;">
        </div>
    {% empty %}
        <p>No photos for this post.</p>
    {% endfor %}
</div>

<br><br>
{% if user.is_authenticated and post.profile.user == user %}
<a href="{% url 'mini_insta:update_post' post.pk %}"
   style="padding: 5px 15px; background-color: lightyellow; text-decoration: none; color: black; border: 1px solid black;">
    Update
</a>

<a href="{% url 'mini_insta:delete_post' post.pk %}"
   style="padding: 5px 15px; background-color: lightcoral; text-decoration: none; color: black; border: 1px solid black;">
    Delete
</a>
{% endif %}

<br><br>
<p>
    <a href="{% url 'mini_insta:show_profile' post.profile.pk %}" style="color: blue; text-decoration: underline;">
        &lt;-- Back to {{ post.profile.display_name }}'s Profile
    </a>
</p>
{% endblock %}
